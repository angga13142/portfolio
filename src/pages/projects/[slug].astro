---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';

export async function getStaticPaths() {
  const projects = (await import('../../data/projects.json')).default;
  return projects.map((p) => ({ params: { slug: p.slug }, props: { project: p } }));
}

const { project } = Astro.props;
---
<BaseLayout title={`${project.title} — Muhammad Nurhidayat Gani`}>
  <Header />
  <main class="max-w-4xl mx-auto px-4 py-16">
    <!-- Project Header -->
    <div class="mb-12">
      <h1 class="text-4xl font-bold mb-4">{project.title}</h1>
      <p class="text-lg text-black/70 dark:text-white/70 mb-6">{project.summary}</p>
      
      <!-- Tags -->
      <div class="flex flex-wrap gap-2 mb-6">
        {project.tags?.map(tag => (
          <span class="px-3 py-1 text-sm rounded-full bg-black/5 dark:bg-white/10">
            {tag}
          </span>
        ))}
      </div>

      <!-- Action Buttons -->
      <div class="flex flex-wrap gap-4">
        {project.links?.demo && (
          <a 
            class="px-6 py-3 bg-accent text-white rounded-lg hover:shadow-lg transition-shadow"
            href={project.links.demo} 
            target="_blank" 
            rel="noopener noreferrer"
          >
            View Demo →
          </a>
        )}
        {project.links?.source && (
          <a 
            class="px-6 py-3 border-2 border-black/10 dark:border-white/20 rounded-lg hover:border-accent transition-colors"
            href={project.links.source} 
            target="_blank" 
            rel="noopener noreferrer"
          >
            Source Code
          </a>
        )}
      </div>
    </div>

    <!-- Project Cover Image -->
    {project.cover && (
      <img 
        src={project.cover}
        alt={project.alt || project.title}
        class="w-full rounded-lg shadow-card mb-12"
        loading="lazy"
        decoding="async"
      />
    )}

    <!-- Project Description -->
    {project.description && (
      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-4">Overview</h2>
        <p class="text-black/80 dark:text-white/80 leading-relaxed">
          {project.description}
        </p>
      </section>
    )}

    <!-- Key Highlights -->
    {project.highlights && project.highlights.length > 0 && (
      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-4">Key Features</h2>
        <ul class="space-y-3">
          {project.highlights.map(highlight => (
            <li class="flex items-start gap-3">
              <span class="text-accent mt-1">✓</span>
              <span class="text-black/80 dark:text-white/80">{highlight}</span>
            </li>
          ))}
        </ul>
      </section>
    )}

    <!-- Tech Stack -->
    {project.techStack && (
      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6">Technology Stack</h2>
        <div class="grid md:grid-cols-2 gap-6">
          {Object.entries(project.techStack).map(([category, technologies]) => (
            <div class="bg-gray-50 dark:bg-gray-800/50 rounded-lg p-6">
              <h3 class="text-lg font-semibold mb-3 capitalize">{category}</h3>
              <ul class="space-y-2">
                {technologies.map(tech => (
                  <li class="text-sm text-black/70 dark:text-white/70">• {tech}</li>
                ))}
              </ul>
            </div>
          ))}
        </div>
      </section>
    )}

    <!-- Challenges -->
    {project.challenges && project.challenges.length > 0 && (
      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-4">Technical Challenges</h2>
        <ul class="space-y-4">
          {project.challenges.map(challenge => (
            <li class="pl-6 border-l-4 border-accent/30 text-black/80 dark:text-white/80">
              {challenge}
            </li>
          ))}
        </ul>
      </section>
    )}

    <!-- Impact Metrics -->
    {project.impact && (
      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6">Impact & Results</h2>
        <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-6">
          {Object.entries(project.impact).map(([metric, value]) => (
            <div class="text-center p-6 bg-gradient-to-br from-accent/5 to-accent/10 rounded-lg">
              <div class="text-2xl font-bold text-accent mb-2">{value}</div>
              <div class="text-sm text-black/60 dark:text-white/60 capitalize">
                {metric.replace(/_/g, ' ')}
              </div>
            </div>
          ))}
        </div>
      </section>
    )}

    <!-- Back to Projects -->
    <div class="mt-16 pt-8 border-t border-black/10 dark:border-white/10">
      <a 
        href="/projects" 
        class="inline-flex items-center gap-2 text-accent hover:underline"
      >
        ← Back to all projects
      </a>
    </div>
  </main>
</BaseLayout>
